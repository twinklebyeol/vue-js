<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://unpkg.com/vuex@3"></script>
  </head>
  <body>
    <div id="app">
      <h1>ì•ˆë…•í•˜ì„¸ìš”!</h1>
      <com-counter msg="ì¹´ìš´í„°1"></com-counter>
      <com-counter msg="ì¹´ìš´í„°2"></com-counter>
    </div>
    <script>
      // ğŸ”´  vuex ì˜ store ì¤‘ì•™ì— actions-mutations-state-getters ì„ ì •ì˜í•¨
      //  ğŸ”´ store ë€ ì €ì¥ì†Œ
      const store = new Vuex.Store({
        state: { count: 0 },
        // mutationsëŠ” gettersì˜ ëŒ€ì¹­ë˜ëŠ” settersì˜ ì—­í• ì„ ì„¤ì •
        mutations: {
          fnIncData: function (state) {
            state.count++;
          },
          fnDecData: function (state) {
            state.count--;
          },
        },
        // ğŸ”´ë°”ë€ê°’ì„ ì €ì¥í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸í•œí…Œ ì•Œë ¤ì¤„ ì¤€ë¹„í•˜ëŠ” ì—­í• 
        getters: {
          fnGetData(state) {
            return state.count;
          },
        },
        //ğŸ”´ ìƒíƒœê°’ì„ ê°ì†Œì‹œí‚¤ëŠ” í•¨ìˆ˜ë¥¼ ì„œë²„ë‹¨ì—ì„œ ì‹¤í–‰í•œë‹¤ê³  ê°€ì •
        // ğŸ”´ë¹„ë™ê¸° ì‹¤í–‰ì„ ìœ„í•´ asyncë¥¼ ì‚¬ìš©í•˜ê³  ë§¤ê°œë³€ìˆ˜ë¡œ commit  ê°ì²´ ì „ë‹¬
        actions: {
          async fnDecData({ commit }, state) {
            // ğŸ”´  ê°€ìƒìœ¼ë¡œ ë§Œë“  ì›ê²© API ì‹¤í–‰
            const result = await api.fnDecrement();
            //  ğŸ”´ ì›ê²© API ê°€ ì„±ê³µí•  ê²½ìš°ì— ë¹„ë¡œì†Œ fnDecDate í•¨ìˆ˜ ì‹¤í–‰
            if (result == true) commit("fnDecData");
          },
        },
      });
      //  ğŸ”´  íƒ€ì´ë¨¸ë¥¼ ì‚¬ìš©í•´ 1ì´ˆ í›„ True ê°’ì„ ë°˜í™˜í•˜ë„ë¡ ê°€ìƒ ì›ê²© ì„œë²„ API ì •ì˜
      const api = {
        fnDecrement() {
          return new Promise((resolve) => {
            setTimeout(() => {
              resolve(true);
            }, 1000);
          });
        },
      };

      //ğŸ”´ com-counter ë¼ëŠ” ì‹ ê·œ ì—˜ë¦¬ë¨¼íŠ¸ ë“±ë¡
      Vue.component("com-counter", {
        props: ["msg"],
        template: `
    <div>
      <h2>{{ msg }}</h2>
      <p>ì¹´ìš´í„°: {{ fnGetCount }}</p>
      <button @click="fnIncCount">+1 ì¦ê°€</button>
      <button @click="fnDecCount">-1 ê°ì†Œ(ì›ê²©APIì‹¤í–‰)</button>
      <hr>
    </div>
  `,
        computed: {
          fnGetCount() {
            //ğŸ”´ ì¹´ìš´í„°ê°’ì€ storeì—ì„œ gettersì— ì ‘ê·¼í•˜ì—¬ ê°’ì„ ê°€ì ¸ì˜¨ í›„ ë Œë”ë§ í•¨
            return store.getters.fnGetData;
          },
        },
        methods: {
          //ğŸ”´ ì¹´ìš´í„° ì¦ê°€ëŠ” ë™ê¸° ì‹¤í–‰ì„ ê°€ì •í•˜ê³  ì§ì ‘ storeì˜ mutationsì— ì ‘ê·¼í•˜ì—¬ ì‹¤í–‰
          fnIncCount() {
            store.commit("fnIncData");
          },
          //ğŸ”´ ì¹´ìš´í„° ê°ì†ŒëŠ” ì›ê²© ì„œë²„ APIë¡œ ë¹„ë™ê¸° ì‹¤í–‰ì„ ê°€ì •í•˜ê³  actionsì— ì ‘ê·¼í•˜ì—¬ ì‹¤í–‰
          fnDecCount() {
            store.dispatch("fnDecData");
          },
        },
      });

      var app = new Vue({
        el: "#app",
        //ğŸ”´ store ì‚¬ìš©ì„ ì„ ì—„í•¨
        store,
      });
    </script>
  </body>
</html>
